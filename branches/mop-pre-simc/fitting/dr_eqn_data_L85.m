baseStr=164;
baseDodge=3.01;
baseParry=3.67;
baseAgi=97;

%data is in the form:
% [STR AGI post_dodge post_parry dodge_rating pre_dodge parry_rating pre_parry]
data1=[510 97 3.01 5.27 0 0 0 0;...
      737 97 3.01 6.30 0 0 0 0;...
      1018 97 3.01 7.57 0 0 0 0;...
      1244 97 3.01 8.57 0 0 0 0;...
      1610 97 3.01 10.19 0 0 0 0;...
      1837 97 3.01 11.18 0 0 0 0;...
      2118 97 3.01 12.39 0 0 0 0;...
      2399 97 3.01 13.60 0 0 0 0;...
      2765 97 3.01 15.14 0 0 0 0;...
      3047 97 3.01 16.32 0 0 0 0;...
      3274 97 3.01 17.26 0 0 0 0;...
      3501 97 3.01 18.19 0 0 0 0;...
      3884 97 3.01 19.74 0 0 0 0;...
      4292 97 3.01 21.37 0 0 0 0;... %last line of ungemmed gear
      4359 97 3.01 21.64 0 0 0 0;...
      4426 97 3.01 21.90 0 0 0 0;...
      4493 97 3.01 22.17 0 0 0 0;...
      4533 97 3.01 22.32 0 0 0 0;...
      4573 97 3.01 22.48 0 0 0 0;...
      4613 97 3.01 22.64 0 0 0 0;...
      4653 97 3.01 22.79 0 0 0 0;...
      4693 97 3.01 22.95 0 0 0 0;...
      4743 97 3.01 23.15 0 0 0 0;...
      4793 97 3.01 23.33 0 0 0 0;...%last line of unenchanted gear
      4843 97 3.01 23.54 0 0 0 0;...
      4893 97 3.01 23.73 0 0 0 0];

d1_str=data1(:,1);d1_agi=data1(:,2);
d1_post_dodge=data1(:,3);d1_post_parry=data1(:,4);
d1_rating_dodge=data1(:,5);d1_pre_dodge=data1(:,6);
d1_rating_parry=data1(:,7);d1_pre_parry=data1(:,8);

d1_net_parry=d1_post_parry-baseParry;
d1_net_str=d1_str-baseStr;
  
data2=[510 97 3.01 6.35 0 0 260 0.98;...
       737 97 3.01 7.91 0 0 389 1.47;...
       1018 97 3.72 9.99 169 0.64 595 2.24;...
       1244 97 3.72 11.64 169 0.64 760 2.87;...
       1610 97 4.78 13.21 427 1.61 760 2.87;...
       1817 97 4.78 14.67 427 1.61 909 3.43;...
       2098 97 5.62 15.85 638 2.41 909 3.43;...
       2308 97 5.62 16.72 638 2.41 909 3.43;...
       2674 97 6.51 19.20 868 3.27 1172 4.42;...
       2884 97 7.57 20.05 1150 4.34 1172 4.42;...
       3057 97 8.40 20.74 1377 5.19 1172 4.42;...
       3284 97 8.93 21.65 1525 5.75 1172 4.42;...
       3459 97 9.37 22.34 1651 6.23 1172 4.42;...
       3606 97 9.88 23.46 1799 6.79 1326 5.00;... %last line of ungemmed
       3606 97 9.88 23.70 1799 6.79 1393 5.26;...
       3606 97 9.88 23.94 1799 6.79 1460 5.51;...
       3606 97 9.88 24.18 1799 6.79 1527 5.76;...
       3606 97 9.88 24.32 1799 6.79 1567 5.91;...
       3606 97 9.88 24.47 1799 6.79 1607 6.06;...
       3606 97 9.88 24.61 1799 6.79 1647 6.21;...
       3606 97 9.88 24.75 1799 6.79 1687 6.36;...
       3606 97 9.88 24.89 1799 6.79 1727 6.52;...
       3606 97 9.88 25.03 1799 6.79 1767 6.67;...
       3606 97 9.88 25.17 1799 6.79 1807 6.82;...
       3606 97 9.88 25.31 1799 6.79 1847 6.97;...
       3606 97 9.88 25.45 1799 6.79 1887 7.12;...
       3989 97 9.88 26.91 1799 6.79 1887 7.12;...%last line of unenchanted
       3989 97 9.96 26.91 1824 6.88 1887 7.12;...
       3989 97 10.13 26.91 1874 7.07 1887 7.12;...
       4039 97 10.13 27.10 1874 7.07 1887 7.12;...%last line of unreforged
       4039 97 10.43 27.10 1960 7.39 1887 7.12;...
       4039 97 10.65 27.10 2026 7.64 1887 7.12;...
       4039 97 10.82 27.10 2077 7.84 1887 7.12;...
       4039 97 10.82 27.43 2077 7.84 1984 7.48;...
       4039 97 10.99 27.43 2130 8.04 1984 7.48;...
       4039 97 10.99 27.64 2130 8.04 2046 7.72;...
       4039 97 10.99 27.83 2130 8.04 2099 7.92;...
       4039 97 10.99 28.04 2130 8.04 2160 8.15;...
       4039 97 10.99 28.19 2130 8.04 2206 8.32;...
       4039 97 10.99 28.40 2130 8.04 2267 8.55;...
       4039 97 10.99 28.53 2130 8.04 2306 8.70];

d2_str=data2(:,1);d2_agi=data2(:,2);
d2_post_dodge=data2(:,3);d2_post_parry=data2(:,4);
d2_rating_dodge=data2(:,5);d2_pre_dodge=data2(:,6);
d2_rating_parry=data2(:,7);d2_pre_parry=data2(:,8);
       
d2_net_dodge=d2_post_dodge-baseDodge;
d2_net_parry=d2_post_parry-baseParry;
d2_net_str=d2_str-baseStr;
       
%fit the dodge data from data2:
d2_try1_ft=fittype('1./(1./C+k./x)');
d2_try1_fo = fitoptions('Method','NonlinearLeastSquares','Lower',[0 0],'Upper',[150 1.5],'StartPoint',[65 0.95]);
[d2_try1_fit d2_try1_gof] = fit(d2_pre_dodge,d2_net_dodge,d2_try1_ft,d2_try1_fo)
%try again, fixing C
d2_try2_ft=fittype('1./(1./65.631440+k./x)');
d2_try2_fo = fitoptions('Method','NonlinearLeastSquares','Lower',[0],'Upper',[1.5],'StartPoint',[0.95]);
[d2_try2_fit d2_try2_gof] = fit(d2_pre_dodge,d2_net_dodge,d2_try2_ft,d2_try2_fo)


%fit the strength->parry data from d1:
p1_try1_ft=fittype('1./(1./C+k./(x./a))');
p1_try1_fo=fitoptions('Method','NonlinearLeastSquares','Lower',[0 0 0.5],'Upper',[350 350 1],'StartPoint',[65 300 0.885]);
[p1_try1_fit p1_try1_gof] = fit(d1_net_str,d1_net_parry,p1_try1_ft,p1_try1_fo)

p1_try2_ft=fittype('1./(1./C+0.885./(x./a))');
p1_try2_fo=fitoptions('Method','NonlinearLeastSquares','Lower',[0 0],'Upper',[350 350],'StartPoint',[65 300]);
[p1_try2_fit p1_try2_gof] = fit(d1_net_str,d1_net_parry,p1_try2_ft,p1_try2_fo)

baseStrParry=baseStr./243.7
q=linspace(240,250,1000);ids=find(roundn(baseStr./q,-2)==0.67);a_bounds=[min(q(ids)) max(q(ids))]

p1_try3_ft=fittype('1./(1./C+0.885./(x./243.7))');
p1_try3_fo=fitoptions('Method','NonlinearLeastSquares','Lower',[0],'Upper',[350],'StartPoint',[65]);
[p1_try3_fit p1_try3_gof] = fit(d1_net_str,d1_net_parry,p1_try3_ft,p1_try3_fo)